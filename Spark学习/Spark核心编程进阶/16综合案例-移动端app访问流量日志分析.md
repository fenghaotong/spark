# 综合案例-移动端app访问流量日志分析

### 移动端app访问流量日志分析

**背景**

- 如果你是在一个互联网公司，然后你的公司现在也在做移动互联网，做了一个手机app，那么你的手机app的用户，每次进行点击，或者是一些搜索操作的时候，都会跟你的远程的后端服务器做一次交互，也就是说，你的手机app，首先会往后端服务器发送一个请求，然后你的后端服务器会给你的手机app返回一个响应，响应的内容可能是图片、或者文字、或者json，此时，就完成了一次你的移动端app和后端服务器之间的交互过程。
- 通常来说，在你的移动端app访问你的后端服务器的时候，你的后端服务器会记录一条日志，这个日志，也就是你的移动端app访问流量的相关日志，但是也可以根据你自己的需要，移动端发送一条日志过来，服务器端的web系统保存日志

**目的**

- 我们这里做的就是最基本的，记录你的移动端app和服务器之间的上行数据包和下行数据包，上行流量和下行流量
- 我们要来计算，就是说，你的每个移动端，唯一的一个标识是你的deviceID
- 每条日志，都会有这一次请求和响应的上行流量和下行流量的记录，上行流量指的是手机app向服务器发送的请求数据的流量，下行流量，认为是服务器端给手机app返回的数据（比如说图片、文字、json）的流量
- 每个设备（deviceID），总上行流量和总下行流量，计算之后，要根据上行流量和下行流量进行排序，需要进行倒序排序，获取流量最大的前10个设备

**难点**

- 根据上行流量和下行流量进行排序的时候，不是简单的排序，优先根据上行流量进行排序，如果上行流量相等，那么根据下行流量排序
- 二次排序

**数据**

```
1454307391161	77e3c9e1811d4fb291d0d9bbd456bb4b	79976	11496
1454315971161	f92ecf8e076d44b89f2d070fb1df7197	95291	89092
1454304331161	3de7d6514f1d4ac790c630fa63d8d0be	57029	50228
1454303131161	dd382d2a20464a74bbb7414e429ae452	20428	93467
1454319991161	bb2956150d6741df875fbcca76ae9e7c	51994	57706
1454302711161	225424dd7dd44d12b4190d1549540bf3	3448	56119
1454316091161	d368d95c643f4943ba1f5ea97b5a9a91	98230	96925
...
```

- 第一个字段：时间戳
- 第二个字段：diviceID
- 第三个字段：上行流量
- 第四个字段：下行流量

**实例代码Java**

[生成随机数据](src/java/appLog/DataGenerator.java)

[自定义二次排序类](src/java/appLog/AccessLogInfo.java)

[将二次排序key映射成RDD的key](src/java/appLog/AccessLogSortKey.java)

[获取top10数据](src/java/appLog/AppLogSpark.java)

